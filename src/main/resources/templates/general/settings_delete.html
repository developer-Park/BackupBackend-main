<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr"
      xmlns:th="http://www.thymeleaf.org">

  <!-- BEGIN: Head-->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0,minimal-ui">
    <meta name="description" content="Vuexy admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Vuexy admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="PIXINVENT">
    <title>Settings - Delete Account</title>
    <link rel="apple-touch-icon" href="../../../app-assets/images/ico/apple-icon-120.png">
    <link rel="shortcut icon" type="image/x-icon" href="../../../app-assets/images/ico/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;0,400;0,500;0,600;1,400;1,500;1,600" rel="stylesheet">

    <!-- BEGIN: Vendor CSS-->
    <link rel="stylesheet" type="text/css" href="../../../app-assets/vendors/css/vendors.min.css">
    <link rel="stylesheet" type="text/css" href="../../../app-assets/vendors/css/forms/select/select2.min.css">
    <link rel="stylesheet" type="text/css" href="../../../app-assets/vendors/css/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="../../../app-assets/vendors/css/extensions/sweetalert2.min.css">
    <!-- END: Vendor CSS-->

    <!-- BEGIN: Theme CSS-->
    <link rel="stylesheet" type="text/css" href="../../../app-assets/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../../app-assets/css/bootstrap-extended.min.css">
    <link rel="stylesheet" type="text/css" href="../../../app-assets/css/colors.min.css">
    <link rel="stylesheet" type="text/css" href="../../../app-assets/css/components.min.css">
    <link rel="stylesheet" type="text/css" href="../../../app-assets/css/themes/dark-layout.min.css">
    <link rel="stylesheet" type="text/css" href="../../../app-assets/css/themes/bordered-layout.min.css">
    <link rel="stylesheet" type="text/css" href="../../../app-assets/css/themes/semi-dark-layout.min.css">

    <!-- BEGIN: Page CSS-->
    <link rel="stylesheet" type="text/css" href="../../../app-assets/css/core/menu/menu-types/vertical-menu.min.css">
    <link rel="stylesheet" type="text/css" href="../../../app-assets/css/plugins/extensions/ext-component-sweet-alerts.min.css">
    <link rel="stylesheet" type="text/css" href="../../../app-assets/css/plugins/forms/form-validation.css">
    <!-- END: Page CSS-->

    <!-- BEGIN: Custom CSS-->
    <link rel="stylesheet" type="text/css" href="../../../assets/css/style.css">
    <!-- END: Custom CSS-->

  </head>
  <!-- END: Head-->

  <!-- BEGIN: Body-->
  <body class="vertical-layout vertical-menu-modern  navbar-floating footer-static  " data-open="click" data-menu="vertical-menu-modern" data-col="">

    <!-- BEGIN: Header-->
    <div th:replace="fragment/top-nav-bar.html
            :: notification(sessionContainer = ${sessionContainer}, userNotifications = ${userNotifications})">
    </div>
  <!-- END: Header-->


    <!-- BEGIN: Main Menu-->
    <div th:if="${sessionContainer.getUserRole().toString().equals('USER')}">
        <div th:replace="fragment/user-left-nav.html
            :: leftNav(sessionContainer = ${sessionContainer})">
        </div>
    </div>

    <div th:if="${sessionContainer.getUserRole().toString().equals('MEDIATOR')}">
        <div th:replace="fragment/mediator-left-nav.html
            :: leftNav(sessionContainer = ${sessionContainer})">
        </div>
    </div>

    <div th:if="${sessionContainer.getUserRole().toString().equals('ADMIN')}">
        <div th:replace="fragment/admin-left-nav.html
            :: leftNav(sessionContainer = ${sessionContainer})">
        </div>
    </div>

    <!-- END: Main Menu-->

    <!-- BEGIN: Content-->
    <div class="app-content content ">
      <div class="content-overlay"></div>
      <div class="header-navbar-shadow"></div>
      <div class="content-wrapper container-xxl p-0">
        <div class="content-header row">
          <div class="content-header-left col-md-9 col-12 mb-2">
            <div class="row breadcrumbs-top">
              <div class="col-12">
                <h2 class="content-header-title float-start mb-0">Delete Account</h2>
                <div class="breadcrumb-wrapper">
                  <ol class="breadcrumb">

                      <li th:if="${sessionContainer.getUserRole().toString().equals('MEDIATOR')}" class="breadcrumb-item">
                          <a href="/mediator/dashboard/">Home</a>
                      </li>

                      <li th:if="${sessionContainer.getUserRole().toString().equals('USER')}" class="breadcrumb-item">
                          <a href="/user/dashboard/">Home</a>
                      </li>

                      <li th:if="${sessionContainer.getUserRole().toString().equals('ADMIN')}" class="breadcrumb-item">
                          <a href="/admin/">Home</a>
                      </li>

                    <li class="breadcrumb-item"><a href="#">Settings </a>
                    </li>
                    <li class="breadcrumb-item active"> Delete Account
                    </li>
                  </ol>
                </div>
              </div>
            </div>
          </div>
            <div class="content-header-right text-md-end col-md-3 col-12 d-md-block d-none">
                <div class="mb-1 breadcrumb-right">
                <div class="dropdown"></div>
                </div>
           </div>
            <div class="content-body"><div class="row">
                <div class="col-12">
                    <ul class="nav nav-pills mb-2">

                      <!-- profile -->
                      <li class="nav-item">
                        <a class="nav-link" href="home">
                          <i data-feather="user" class="font-medium-3 me-50"></i>
                          <span class="fw-bold">Profile</span>
                        </a>
                      </li>
                      <!-- security -->
                      <li class="nav-item">
                        <a class="nav-link" href="security">
                          <i data-feather="lock" class="font-medium-3 me-50"></i>
                          <span class="fw-bold">Security</span>
                        </a>
                      </li>
                      <!--account delete-->
                      <li class="nav-item">
                        <a class="nav-link active" href="delete">
                          <i data-feather="user-x" class="font-medium-3 me-50"></i>
                          <span class="fw-bold">Delete Account</span>
                        </a>
                      </li>

                    </ul>
                </div>
            </div>
        </div>

    <!-- deactivate account  -->
    <div class="card">
      <div class="card-header border-bottom">
        <h4 class="card-title">Delete Account</h4>
      </div>
      <div class="card-body py-2 my-25">
        <div class="alert alert-warning">
          <h4 class="alert-heading">Are you sure you want to delete your account?</h4>
          <div class="alert-body fw-normal">
            Once you delete your account, there is no going back. Please be certain.
          </div>
        </div>

        <form id="formAccountDeactivation" class="validate-form" onsubmit="TriggerDisable()">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              name="accountActivation"
              id="accountActivation"
              data-msg="Please confirm you want to delete account"
            />
            <label class="form-check-label font-small-3" for="accountDeactivation">
              I confirm my account deactivation
            </label>
          </div>
          <div>
            <button type="submit" class="btn btn-danger deactivate-account mt-1">Deactivate Account</button>
          </div>
        </form>
      </div>
    </div>
    </div>
</div>
    <!-- END: Content-->


    <!-- BEGIN: Footer-->
    <footer class="footer footer-static footer-light">

    </footer>
    <button class="btn btn-primary btn-icon scroll-top" type="button"><i data-feather="arrow-up"></i></button>
    <!-- END: Footer-->


    <!-- BEGIN: Vendor JS-->
    <script src="../../../app-assets/vendors/js/vendors.min.js"></script>
    <!-- BEGIN Vendor JS-->

    <!-- BEGIN: Page Vendor JS-->
    <script src="../../../app-assets/vendors/js/forms/select/select2.full.min.js"></script>
    <script src="../../../app-assets/vendors/js/extensions/sweetalert2.all.min.js"></script>
    <script src="../../../app-assets/vendors/js/forms/validation/jquery.validate.min.js"></script>
    <script src="../../../app-assets/vendors/js/forms/cleave/cleave.min.js"></script>
    <script src="../../../app-assets/vendors/js/forms/cleave/addons/cleave-phone.us.js"></script>
    <!-- END: Page Vendor JS-->

    <!-- BEGIN: Theme JS-->
    <script src="../../../app-assets/js/core/app-menu.min.js"></script>
    <script src="../../../app-assets/js/core/app.min.js"></script>
    <script src="/custom-scripts/axios.min.js"></script>
    <script src="../../../app-assets/js/scripts/customizer.min.js"></script>
    <!-- END: Theme JS-->

    <!-- BEGIN: Page JS-->
    <script src="../../../app-assets/js/scripts/pages/page-account-settings-account.min.js"></script>
    <!-- END: Page JS-->

    <script>
      $(window).on('load',  function(){
        if (feather) {
          feather.replace({ width: 14, height: 14 });
        }
      })

     async function DisableAccount(jsn) {
        console.log("Sending", jsn);
        let res = await axios.post('/api/v1/pri/general/settings/delete', {});
        return res;
     }

     async function TriggerDisable() {

        let i = 0;
        while(window.deactivationStatus == null && i++ < 60) {
            await new Promise(r => setTimeout(r, 1000));
        }

        if (window.deactivationStatus == null) {
            return;
        }

        if (window.deactivationStatus) {
            window.deactivationStatus = false;
            await DisableAccount({});
            document.location = '/general/logout';
        }else {
            window.deactivationStatus = null;
        }

     }


    </script>
  </body>
  <!-- END: Body-->
</html>